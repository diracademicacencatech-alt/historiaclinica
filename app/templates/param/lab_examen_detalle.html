{% extends "base.html" %}
{% block title %}Examen: {{ examen.nombre }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>üß™ Examen: {{ examen.nombre }}</h2>
  <p class="text-muted">Grupo: {{ examen.grupo or '-' }}</p>

  <!-- Formulario a√±adir par√°metro -->
  <div class="card mb-4">
    <div class="card-header">
      A√±adir par√°metro
    </div>
    <div class="card-body">
      <form method="POST">
        <div class="row g-2">
          <div class="col-md-4">
            <label class="form-label">Nombre par√°metro</label>
            <input type="text" name="nombre" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Unidad</label>
            <input type="text" name="unidad" class="form-control">
          </div>
          <div class="col-md-2">
            <label class="form-label">Valor ref. min</label>
            <input type="number" step="0.001" name="valor_ref_min" class="form-control">
          </div>
          <div class="col-md-2">
            <label class="form-label">Valor ref. max</label>
            <input type="number" step="0.001" name="valor_ref_max" class="form-control">
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-success w-100">
              Agregar
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de par√°metros -->
  <h5>Par√°metros definidos</h5>
<table class="table table-sm table-striped">
  <thead class="table-dark">
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Unidad</th>
      <th>Ref. min</th>
      <th>Ref. max</th>
      <th style="width:140px;">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for p in parametros %}
    <tr>
      <td>{{ p.id }}</td>
      <td>
        <form method="POST"
              action="{{ url_for('param.laboratorio_parametro_editar', param_id=p.id) }}"
              class="d-flex gap-1">
          <input type="text" name="nombre" class="form-control form-control-sm"
                 value="{{ p.nombre }}">
      </td>
      <td>
          <input type="text" name="unidad" class="form-control form-control-sm"
                 value="{{ p.unidad or '' }}">
      </td>
      <td>
          <input type="number" step="0.001" name="valor_ref_min"
                 class="form-control form-control-sm"
                 value="{{ p.valor_ref_min if p.valor_ref_min is not none else '' }}">
      </td>
      <td>
          <input type="number" step="0.001" name="valor_ref_max"
                 class="form-control form-control-sm"
                 value="{{ p.valor_ref_max if p.valor_ref_max is not none else '' }}">
      </td>
      <td>
          <button type="submit" class="btn btn-success btn-sm me-1">
            Guardar
          </button>
        </form>
        <form method="POST"
              action="{{ url_for('param.laboratorio_parametro_eliminar', param_id=p.id) }}"
              style="display:inline"
              onsubmit="return confirm('¬øEliminar par√°metro {{ p.nombre }}?');">
          <button type="submit" class="btn btn-danger btn-sm">
            X
          </button>
        </form>
      </td>
    </tr>
    {% endfor %}
    {% if not parametros %}
    <tr>
      <td colspan="6" class="text-center text-muted">
        Sin par√°metros definidos para este examen.
      </td>
    </tr>
    {% endif %}
  </tbody>
</table>
  <a href="{{ url_for('param.laboratorios') }}" class="btn btn-secondary btn-sm">‚Üê Volver a lista de ex√°menes</a>
</div>
{% endblock %}
