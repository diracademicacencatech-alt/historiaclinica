{% extends "base.html" %}

{% block title %}Im√°genes Diagn√≥sticas - Software SM{% endblock %}

{% block head %}
<style>
    :root {
      --titles: #236e7b;
      --text-links: #0b6169;
      --text-secondary: #5f5f5f;
    }

    .titulo-principal { 
      color: var(--titles); 
      text-align: center; 
      margin-bottom: 30px; 
      font-weight: 800;
      text-transform: uppercase;
    }

    .titulo-seccion {
      color: var(--titles);
      font-weight: 700;
      font-size: 1.1rem;
      margin-top: 25px;
      margin-bottom: 15px;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* BLOQUE DE INFORMACI√ìN DEL PACIENTE */
    .section-white-box {
      background: #ffffff;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03);
      border-left: 6px solid var(--titles);
    }

    /* TABLAS ESTILO SM */
    .table-sm-custom {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }

    .table-sm-custom thead {
        background-color: var(--titles);
        color: white;
        text-transform: uppercase;
        font-size: 0.85rem;
    }

    /* BOTONES VERDES (PRINCIPALES) */
    .btn-sm-verde {
        background-color: var(--titles) !important;
        color: white !important;
        border: none !important;
        font-weight: 700;
        text-transform: uppercase;
        padding: 12px 20px;
        border-radius: 10px;
        transition: all 0.2s;
    }

    .btn-sm-verde:hover {
        background-color: var(--text-links) !important;
        transform: translateY(-2px);
    }

    /* NAVEGACI√ìN INFERIOR */
    .nav-links {
      margin-top: 40px;
      padding-top: 25px;
      border-top: 1px dashed rgba(0,0,0,0.15);
      text-align: center;
    }

    .btn-nav {
      color: var(--text-links);
      text-decoration: none;
      font-weight: 700;
      font-size: 13px;
      padding: 10px 15px;
      border-radius: 8px;
      text-transform: uppercase;
    }
</style>
{% endblock %}

{% block content %}
  <h2 class="titulo-principal">üì∑ Im√°genes Diagn√≥sticas</h2>

  <h5 class="titulo-seccion">üìã Datos del Paciente</h5>
  <div class="section-white-box">
    <div class="row">
      <div class="col-md-6 border-end">
        <p><strong>Paciente:</strong> {{ paciente.nombre }}</p>
        <p><strong>Identificaci√≥n:</strong> {{ paciente.numero }}</p>
        <p><strong>Cama:</strong> {{ paciente.cama or 'No asignada' }}</p>
      </div>
      <div class="col-md-6 ps-md-4">
        <p><strong>N¬∞ Historia:</strong> {{ historia.numero_historia }}</p>
        <p><strong>Ingreso N¬∞:</strong> {{ historia.numero_ingreso }}</p>
        <p><strong>Fecha Registro:</strong> {{ historia.fecha_registro.strftime('%d/%m/%Y') }}</p>
      </div>
    </div>
  </div>

  <h5 class="titulo-seccion">üìÅ Estudios Registrados</h5>
  <div class="table-responsive table-sm-custom mb-4">
    <table class="table table-hover align-middle mb-0">
      <thead>
        <tr>
          <th class="ps-3">Examen / Estudio</th>
          <th>Fecha</th>
          <th style="width: 40%;">Observaciones</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% if examenes %}
          {% for e in examenes %}
          <tr>
            <td class="ps-3"><strong>{{ e.nombre_examen }}</strong></td>
            <td class="text-muted">{{ e.fecha_resultado.strftime('%d/%m/%Y') if e.fecha_resultado else '-' }}</td>
            <td>
                <form method="post" class="d-flex gap-2">
                    <input type="hidden" name="ayuda_id" value="{{ e.id }}">
                    <textarea name="observaciones" class="form-control form-control-sm" rows="1">{{ e.observaciones or '' }}</textarea>
                    <button type="submit" class="btn btn-sm btn-outline-secondary">Ok</button>
                </form>
            </td>
            <td class="text-center">
              {% if e.archivo %}
                <a href="{{ url_for('ayudas.ver_archivo_ayuda', ayuda_id=e.id) }}" class="btn btn-sm btn-outline-primary" target="_blank">Ver</a>
              {% endif %}
              <form action="{{ url_for('ayudas.eliminar_ayuda', ayuda_id=e.id) }}" method="post" class="d-inline">
                <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('¬øEliminar?');">X</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="4" class="text-center py-4 text-muted">No hay im√°genes registradas.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <h5 class="titulo-seccion">‚ûï Agregar Nuevo Estudio</h5>
  <div class="section-white-box">
    <form method="post" enctype="multipart/form-data">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-bold" style="color: var(--titles);">Nombre del Examen</label>
          <input type="text" name="nombre_examen" class="form-control shadow-sm" required placeholder="Ej: TAC de Cr√°neo">
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-bold" style="color: var(--titles);">Fecha del Resultado</label>
          <input type="date" name="fecha_resultado" class="form-control shadow-sm">
        </div>
        <div class="col-md-12 mb-3">
          <label class="form-label fw-bold" style="color: var(--titles);">Cargar Archivo (Opcional)</label>
          <input type="file" name="archivo" class="form-control shadow-sm">
        </div>
        <div class="col-md-12 mb-4">
          <label class="form-label fw-bold" style="color: var(--titles);">Observaciones</label>
          <textarea name="observaciones" class="form-control shadow-sm" rows="2"></textarea>
        </div>
      </div>
      <button type="submit" class="btn btn-sm-verde w-100 shadow">
          üíæ GUARDAR ESTUDIO DE IMAGEN
      </button>
    </form>
  </div>

  <div class="nav-links">
    <a href="{{ url_for('ayudas.menu_ayudas_historia', historia_id=historia.id) }}" class="btn-nav">
        ‚Üê Volver al Men√∫ de Ayudas
    </a>
    <span class="separator">|</span>
    <a href="{{ url_for('menu.inicio') }}" class="btn-nav">
        Volver al Inicio
    </a>
  </div>
{% endblock %}