{% extends "base.html" %}
{% block title %}Cat√°logo de laboratorios{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">

    <h2 class="sm-main-title">Cat√°logo de laboratorios</h2>
    <p class="sm-main-subtitle">
      Administrar el cat√°logo global de ex√°menes y par√°metros (no por paciente).
    </p>

    <!-- Descargar / Cargar cat√°logo (EXCEL DE CAT√ÅLOGO) -->
<div class="mb-4">
  <!-- Bot√≥n descargar -->
  <div class="mb-2">
    <a href="{{ url_for('ayudas.descargar_catalogo_template') }}"
       class="btn btn-outline-success">
      üì• Descargar cat√°logo (Excel)
    </a>
  </div>

  <!-- Subir cat√°logo -->
  <div class="mb-2">
    <form method="post" enctype="multipart/form-data"
          action="{{ url_for('ayudas.cargar_catalogo_laboratorios') }}">
      <div class="d-flex flex-column flex-md-row gap-2">
        <input type="file" name="archivo_catalogo" class="form-control" required>
        <button type="submit" class="btn btn-outline-primary">
          üì§ Subir cat√°logo modificado
        </button>
      </div>
    </form>
  </div>

  <!-- Volver -->
  <div>
    <a href="{{ url_for('ayudas.inicio_ayudas') }}" class="btn btn-link p-0">
      ‚Üê Volver a ayudas diagn√≥sticas
    </a>
  </div>
</div>


    <!-- Tabla de ex√°menes -->
    <div class="card mt-3">
  <div class="card-header">Ex√°menes en cat√°logo</div>
  <div class="card-body p-0">
    <div class="table-responsive" style="min-width: 100%;">
      <table class="table table-striped table-hover align-middle mb-0 w-100">
        <thead class="table-light">
          <tr>
            <th>Examen</th>
            <th>Grupo</th>
            <th>Estado</th>
            <th>Par√°metros</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
        {% if examenes %}
          {% for ex in examenes %}
            <tr>
              <td class="fw-semibold text-wrap" style="max-width: 180px;">{{ ex.nombre }}</td>
              <td class="text-wrap" style="max-width: 140px;">{{ ex.grupo or '-' }}</td>
              <td>
                <span class="badge {{ 'bg-success' if ex.activo else 'bg-secondary' }}">
                  {{ 'Activo' if ex.activo else 'Inactivo' }}
                </span>
              </td>
              <td class="text-wrap" style="max-width: 260px;">
                {% if ex.parametros %}
                  {{ ex.parametros|map(attribute='nombre')|join(', ') }}
                {% else %}
                  <span class="text-muted">Sin par√°metros</span>
                {% endif %}
              </td>
              <td class="text-end">
                <form action="{{ url_for('ayudas.toggle_examen_catalogo', examen_id=ex.id) }}"
                      method="post" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-outline-secondary">
                    {{ 'Desactivar' if ex.activo else 'Activar' }}
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted py-3">
              No hay ex√°menes en el cat√°logo.
            </td>
          </tr>
        {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>


  </div>
</div>
{% endblock %}
