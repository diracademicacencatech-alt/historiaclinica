<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalle de Registros de Enfermería</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container mt-4">
  <h2>Registros de Enfermería para {{ paciente.nombre }} ({{ paciente.numero }})</h2>

  {% if registros %}
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Signos Vitales</th>
        <th>Líquidos Administrados</th>
        <th>Líquidos Eliminados</th>
        <th>Glicemia</th>
        <th>Observaciones</th>
      </tr>
    </thead>
    <tbody>
    {% for registro in registros %}
      {% set sv = registro.signos_vitales_dict %}
      {% set admin = registro.balance_liquidos_dict.administrados %}
      {% set elim = registro.balance_liquidos_dict.eliminados %}
      <tr>
        <td>{{ registro.fecha_registro.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
          t/a: {{ sv.get('ta','') }}<br>
          fc: {{ sv.get('fc','') }}<br>
          fr: {{ sv.get('fr','') }}<br>
          t°: {{ sv.get('temp','') }}<br>
          SO2: {{ sv.get('so2','') }}
        </td>
        <td>
          <b>Hora Inicial:</b> {{ admin.get('hora_inicial','') }}<br>
          <b>Hora Final:</b> {{ admin.get('hora_final','') }}<br>
          <b>Líquido:</b> {{ admin.get('liquido','') }}<br>
          <b>Vía:</b> {{ admin.get('via','') }}<br>
          <b>Cantidad:</b> {{ admin.get('cantidad','') }}
        </td>
        <td>
          <b>Hora Eliminado:</b> {{ elim.get('hora_eliminado','') }}<br>
          <b>Tipo Líquido:</b> {{ elim.get('tipo_liquido','') }}<br>
          <b>Vía:</b> {{ elim.get('via_eliminacion','') }}<br>
          <b>Cantidad:</b> {{ elim.get('cantidad','') }}<br>
          <b>Obs:</b> {{ elim.get('obs','') }}
        </td>
        <td>{{ registro.control_glicemia or '' }}</td>
        <td>{{ registro.observaciones or '' }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="alert alert-info">No hay registros disponibles para este paciente.</div>
  {% endif %}

  {% if notas %}
    <h3>Últimas notas de enfermería</h3>
    <ul class="list-group mb-3">
      {% for nota in notas %}
        <li class="list-group-item">
          <strong>{{ nota.fecha_registro.strftime('%Y-%m-%d %H:%M') }}</strong>
          – {{ nota.tipo_nota|capitalize }}<br>
          {{ nota.texto_nota[:120] }}{% if nota.texto_nota|length > 120 %}...{% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}

  <a class="btn btn-secondary"
     href="{{ url_for('enfermeria.menu_paciente', paciente_id=paciente.id) }}">
    Volver al menú de enfermería
  </a>
</div>
</body>
</html>
