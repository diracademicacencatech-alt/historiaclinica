{% extends "base.html" %}
{% block title %}Registro de Enfermería - Software SM{% endblock %}

{% block head %}
<style>
    :root {
      --sm-bg-principal: #ffffff;
      --sm-card-bg: #f0e7d8;
      --sm-titles-btns: #236e7b; 
      --sm-text-links: #0b6169;
      --sm-secondary-text: #5f5f5f;
    }

    body { 
        background-color: var(--sm-bg-principal) !important; 
        color: var(--sm-text-links); 
        font-family: 'Segoe UI', system-ui, sans-serif;
        font-size: 0.82rem;
    }

    .container-custom { max-width: 1000px; margin: auto; }

    .banner-turno {
        background-color: var(--sm-titles-btns);
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        border-bottom: 3px solid #0b6169;
    }

    .panel-sm { background: white; border: 1px solid #dee2e6; border-radius: 4px; margin-bottom: 15px; }
    .panel-header { 
        background: #f1f3f5; padding: 6px 12px; font-weight: 700; color: var(--sm-titles-btns); 
        border-bottom: 1px solid #dee2e6; text-transform: uppercase; font-size: 0.7rem;
        display: flex; justify-content: space-between; align-items: center;
    }
    .panel-body { padding: 10px; }
    .bg-paciente { background-color: var(--sm-card-bg) !important; }

    .form-label { font-weight: 700; color: var(--sm-secondary-text); font-size: 0.65rem; margin-bottom: 2px; display: block; }
    .form-control-sm { border: 1px solid #ced4da; border-radius: 3px; padding: 4px 8px; font-size: 0.8rem; width: 100%; }

    .btn-institucional {
        background-color: var(--sm-titles-btns); color: white; font-weight: 700; border: none;
        padding: 5px 12px; border-radius: 3px; font-size: 0.7rem; cursor: pointer; text-transform: uppercase;
    }

    .table-sm { width: 100%; border-collapse: collapse; font-size: 0.8rem; background: white; margin-bottom: 20px; }
    .table-sm th { 
        background: #ffffff; color: var(--sm-titles-btns); padding: 8px; 
        border-bottom: 2px solid var(--sm-titles-btns); text-align: center;
    }
    .table-sm td { padding: 7px; border-bottom: 1px solid #f0f0f0; text-align: center; color: #333; }

    .historial-titulo { 
        color: var(--sm-titles-btns); font-weight: 800; font-size: 0.9rem;
        margin: 20px 0 10px 0; border-left: 4px solid var(--sm-titles-btns); padding-left: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container container-custom py-2">

    <div class="banner-turno">
        <h6 class="m-0 fw-bold">SOFTWARE SM - TURNO {{ turno_actual }}</h6>
        <span class="small fw-bold">{{ fecha_hoy }}</span>
    </div>

    <form method="post">
        <div class="panel-sm bg-paciente">
            <div class="panel-body py-2">
                <label class="form-label">Paciente en Atención</label>
                <select name="historia_clinica_id" class="form-control-sm fw-bold border-0" style="background: transparent;">
                    {% for h in historias %}
                    <option value="{{ h.id }}">HC: {{ h.numero_ingreso }} - {{ h.paciente.nombre }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="turno" value="{{ turno_actual }}">
            </div>
        </div>

        <div class="row gx-2">
            <div class="col-12">
                <div class="panel-sm">
                    <div class="panel-header">
                        <span>Signos Vitales</span>
                        <button type="submit" name="action" value="save_sv" class="btn-institucional">Guardar Signos</button>
                    </div>
                    <div class="panel-body">
                        <div class="row gx-2">
                            <div class="col-md-2 col-4"><label class="form-label">T.A.</label><input type="text" name="ta" class="form-control-sm"></div>
                            <div class="col-md-2 col-4"><label class="form-label">F.C.</label><input type="text" name="fc" class="form-control-sm"></div>
                            <div class="col-md-2 col-4"><label class="form-label">F.R.</label><input type="text" name="fr" class="form-control-sm"></div>
                            <div class="col-md-2 col-4"><label class="form-label">TEMP.</label><input type="text" name="temp" class="form-control-sm"></div>
                            <div class="col-md-2 col-4"><label class="form-label">SO2</label><input type="text" name="so2" class="form-control-sm"></div>
                            <div class="col-md-2 col-4"><label class="form-label">GLICEMIA</label><input type="number" step="0.1" name="control_glicemia" class="form-control-sm"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="panel-sm">
                    <div class="panel-header">
                        <span>Líquidos Administrados</span>
                        <button type="submit" name="action" value="save_admin" class="btn-institucional">Guardar Ingreso</button>
                    </div>
                    <div class="panel-body">
                        <div class="row gx-2 mb-2">
                            <div class="col-6"><label class="form-label">Hora Inicio</label><input type="time" name="hora_inicial" class="form-control-sm"></div>
                            <div class="col-6"><label class="form-label">Cant (ml)</label><input type="number" name="cantidad_admin" class="form-control-sm"></div>
                        </div>
                        <label class="form-label">Líquido / Solución</label>
                        <input type="text" name="liquido_admin" class="form-control-sm mb-2" list="opts_sol">
                        <label class="form-label">Vía de Administración</label>
                        <input type="text" name="via_admin" class="form-control-sm" list="opts_v_ad">
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="panel-sm">
                    <div class="panel-header">
                        <span>Líquidos Eliminados</span>
                        <button type="submit" name="action" value="save_elim" class="btn-institucional">Guardar Egreso</button>
                    </div>
                    <div class="panel-body">
                        <div class="row gx-2 mb-2">
                            <div class="col-6"><label class="form-label">Hora</label><input type="time" name="hora_eliminado" class="form-control-sm"></div>
                            <div class="col-6"><label class="form-label">Cant (ml)</label><input type="number" name="cantidad_elim" class="form-control-sm"></div>
                        </div>
                        <label class="form-label">Tipo de Líquido</label>
                        <input type="text" name="tipo_liquido" class="form-control-sm mb-2" list="opts_elim_tipo">
                        <label class="form-label">Vía de Eliminación</label>
                        <input type="text" name="via_eliminado" class="form-control-sm" list="opts_elim_via">
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="historial-titulo">REGISTROS DEL TURNO {{ turno_actual }}</div>

    <table class="table-sm">
        <thead>
            <tr><th>HORA</th><th>T.A.</th><th>F.C.</th><th>F.R.</th><th>T°</th><th>SO2</th><th>GLIC.</th></tr>
        </thead>
        <tbody>
            {% for r in registros %}
                {% if r.sv.ta or r.sv.fc or r.sv.temp %}
                <tr>
                    <td class="fw-bold" style="color: var(--sm-titles-btns);">{{ r.fecha_registro.strftime('%H:%M') }}</td>
                    <td>{{ r.sv.ta or '-' }}</td><td>{{ r.sv.fc or '-' }}</td><td>{{ r.sv.fr or '-' }}</td>
                    <td>{{ r.sv.temp or '-' }}</td><td>{{ r.sv.so2 or '-' }}</td><td>{{ r.control_glicemia or '-' }}</td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>

    <table class="table-sm">
        <thead>
            <tr><th>HORA</th><th>ADMINISTRADOS</th><th>ELIMINADOS</th><th>SUBTOTAL</th></tr>
        </thead>
        <tbody>
            {% for r in registros %}
                {% if r.bl_admin.cantidad or r.bl_elim.cantidad %}
                <tr>
                    <td>{{ r.fecha_registro.strftime('%H:%M') }}</td>
                    <td>{% if r.bl_admin.cantidad %}<b>{{ r.bl_admin.liquido }}</b> | +{{ r.bl_admin.cantidad }} ml{% else %}-{% endif %}</td>
                    <td>{% if r.bl_elim.cantidad %}<b>{{ r.bl_elim.tipo_liquido }}</b> | -{{ r.bl_elim.cantidad }} ml{% else %}-{% endif %}</td>
                    {% set adm = r.bl_admin.cantidad|float if r.bl_admin.cantidad else 0 %}
                    {% set eli = r.bl_elim.cantidad|float if r.bl_elim.cantidad else 0 %}
                    <td class="fw-bold">{{ (adm-eli)|round(1) }} ml</td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
        <tfoot style="background: #f8f9fa; border-top: 2px solid var(--sm-titles-btns);">
            <tr class="fw-bold">
                <td class="text-end">TOTALES TURNO:</td>
                <td class="text-primary">+{{ total_admin }} ml</td>
                <td class="text-danger">-{{ total_elim }} ml</td>
                <td style="background: var(--sm-card-bg); color: var(--sm-titles-btns);">{{ balance_total }} ml</td>
            </tr>
        </tfoot>
    </table>
</div>

<datalist id="opts_sol">
    <option value="AGUA MAS MTO"><option value="ALMUERZO"><option value="AROIMATICA CON GALLRTICAS">
    <option value="CENA"><option value="COLADA"><option value="COMIDA"><option value="DESAYUNO">
    <option value="DIETA"><option value="MEDICAMENTO"><option value="MEDICAMENTO + AGUA">
    <option value="MEDICAMENTO + SSN0.9%"><option value="SSN"><option value="SSN MAS MTO">
</datalist>

<datalist id="opts_v_ad">
    <option value="Oral"><option value="Oral Sonda"><option value="Oral Succion">
    <option value="Endovenosa"><option value="Intramuscular"><option value="Subcutaneo">
    <option value="Tópico"><option value="Infusión"><option value="Nutricion Enteral">
    <option value="Nutricion Parenteral"><option value="Inhalatoria"><option value="Intrarrectal">
    <option value="Transdérmica"><option value="Sublingual"><option value="Vaginal"><option value="Oftálmica">
    <option value="Ótica"><option value="Intradérmica"><option value="Bucal"><option value="Por sonda nasogástrica">
    <option value="Rectal"><option value="Por Sonda rectal"><option value="Cutánea"><option value="Nasal">
</datalist>

<datalist id="opts_elim_tipo">
    <option value="EMESIS"><option value="MATERIA FECAL"><option value="ORINA">
    <option value="SANGRE"><option value="BILIAR"><option value="LIQUIDO PLEURAL"><option value="OTRO">
</datalist>

<datalist id="opts_elim_via">
    <option value="Sonda Vesical"><option value="Diarrea"><option value="Emesis"><option value="Sonda Gastrica">
    <option value="Dren Penrose"><option value="Hemovac"><option value="Otros Drenes"><option value="Tubo en T">
    <option value="Tubo a Torax"><option value="Ventriculostomia"><option value="Bolsa Recolectora">
    <option value="Irrigacion Vesical"><option value="Espontaneo"><option value="Cateter Percutaneo">
    <option value="Ultra Filtrado"><option value="Oral"><option value="Otras"><option value="Todas las Vias">
</datalist>

{% endblock %}