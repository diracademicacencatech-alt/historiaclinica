<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Nuevo Paciente + Historia de Ingreso</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    h1 { color: #2c3e50; text-align: center; margin-bottom: 10px; }
    h2 { color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 30px; }
    h3 { color: #2c3e50; margin-top: 25px; }
    label { display: block; margin-top: 15px; font-weight: bold; color: #2c3e50; }
    input, select, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 2px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
    textarea { resize: vertical; min-height: 100px; }
    button { background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; cursor: pointer; padding: 15px 40px; border-radius: 8px; font-size: 18px; margin-top: 25px; width: 100%; }
    button:hover { background: linear-gradient(135deg, #218838, #1ea085); }
    .btn-secondary { background: #6c757d; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; margin-top: 20px; }
    .btn-secondary:hover { background: #5a6268; }
    .message { padding: 15px; margin: 20px 0; border-radius: 8px; font-weight: bold; }
    .success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
    .danger { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
    .warning { background: #fff3cd; color: #856404; border-left: 4px solid #ffc107; }
    .section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db; }
    .required { color: red; }
    .row { display: flex; gap: 20px; }
    .col { flex: 1; }
    @media (max-width: 768px) { .row { flex-direction: column; } }
    .row.g-2 { gap: 10px; }
    .med-title { margin-top: 10px; }
  </style>

  <!-- jQuery + jQuery UI para autocomplete CIE-10 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet"
        href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Historia Clinica de Ingreso</h1>
    <p style="text-align: center; color: #666; margin-bottom: 30px;">
      Crea un nuevo paciente y su historia cl√≠nica de ingreso en un solo formulario
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="message {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST">
      <!-- SECCI√ìN 1: DATOS DEL PACIENTE -->
      <div class="section">
        <h2>üë§ Datos del Paciente</h2>
        <div class="row">
          <div class="col">
            <label for="nombre">Nombre Completo <span class="required">*</span></label>
            <input type="text" id="nombre" name="nombre" required>
          </div>
          <div class="col">
            <label for="numero">N√∫mero <span class="required">*</span></label>
            <input type="text" id="numero" name="numero" required>
          </div>
        </div>
        <label for="cama">Cama</label>
        <input type="text" id="cama" name="cama">
      </div>

      <!-- SECCI√ìN 2: DATOS DE INGRESO -->
      <div class="section">
        <h2>üè• Datos de Ingreso</h2>
        <div class="row">
          <div class="col">
            <label for="numero_historia">N√∫mero de Historia <span class="required">*</span></label>
            <input type="text" id="numero_historia" name="numero_historia" required>
          </div>
          <div class="col">
            <label for="numero_ingreso">N√∫mero de Ingreso <span class="required">*</span></label>
            <input type="text" id="numero_ingreso" name="numero_ingreso" required>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="servicio_hospitalario">Servicio hospitalario</label>
            <select id="servicio_hospitalario" name="servicio_hospitalario">
              <option value="">-- Seleccione servicio --</option>
              <option value="ginecologia">Ginecolog√≠a</option>
              <option value="observacion_adultos">Observaci√≥n adultos</option>
              <option value="emergencias_adultos">Emergencias adultos</option>
              <option value="cirugia_adultos">Cirug√≠a adultos</option>
              <option value="pediatria">Pediatr√≠a</option>
              <option value="cirugia_umi">Cirug√≠a UMI</option>
              <option value="urgencias_pediatria">Urgencias pediatr√≠a</option>
              <option value="uci_adultos">UCI adultos</option>
              <option value="uci_pediatria">UCI pediatr√≠a</option>
              <option value="uci_neonatal">UCI neonatal</option>
              <option value="neonatos">Neonatos</option>
            </select>
          </div>
        </div>
      </div>

      <!-- SECCI√ìN 3: DATOS PERSONALES -->
      <div class="section">
        <h3>üìã Datos Personales</h3>
        <div class="row">
    <div class="col-md-6">
        <div class="form-group">
            <label for="fecha_nacimiento">üìÖ Fecha de Nacimiento *</label>
            <input 
                type="date" 
                id="fecha_nacimiento"
                name="fecha_nacimiento" 
                class="form-control" 
                required
            >
        </div>
    </div>
    <div class="col-md-6">
        <div class="form-group">
            <label for="edad">üéÇ Edad (a√±os) *</label>
            <input 
                type="number" 
                id="edad"
                name="edad" 
                class="form-control bg-light" 
                readonly
                min="0" max="150"
            >
        </div>
    </div>
</div>
        <div class="row">
          <div class="col">
            <label for="sexo">Sexo</label>
            <select id="sexo" name="sexo">
              <option value="">Seleccione</option>
              <option value="Masculino">Masculino</option>
              <option value="Femenino">Femenino</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
          <div class="col">
            <label for="telefono">Tel√©fono</label>
            <input type="text" id="telefono" name="telefono">
          </div>
        </div>
        <label for="direccion">Direcci√≥n</label>
        <input type="text" id="direccion" name="direccion">
        <label for="procedencia">Procedencia</label>
        <div style="position: relative;">
    <input type="text" class="form-control" id="procedencia" name="procedencia" 
           placeholder="Escribe inicial de ciudad (P = Popay√°n)..." required autocomplete="off">
    <div id="procedencia_lista" class="dropdown-menu w-100" 
         style="display: none; max-height: 200px; overflow-y: auto; position: absolute; top: 100%; left: 0; right: 0; margin-top: -1px; z-index: 1000;">
    </div>
</div>
      </div>

      <!-- SECCI√ìN 4: AFILIACI√ìN + ACUDIENTE -->
      <div class="section">
        <h3>üí≥ Afiliaci√≥n y Acudiente</h3>
        <div class="row">
          <div class="col">
            <label for="regimen">R√©gimen</label>
            <select id="regimen" name="regimen">
              <option value="">Seleccione</option>
              <option value="Contributivo">Contributivo</option>
              <option value="Subsidiado">Subsidiado</option>
              <option value="Vinculado">Vinculado</option>
              <option value="Particular">Particular</option>
            </select>
          </div>
          <div class="col">
            <label for="estrato">Estrato</label>
            <select id="estrato" name="estrato">
              <option value="">Seleccione</option>
              <option value="1">1</option><option value="2">2</option>
              <option value="3">3</option><option value="4">4</option>
              <option value="5">5</option><option value="6">6</option>
            </select>
          </div>
        </div>
        <label for="plan_beneficios">Plan de Beneficios</label>
        <input type="text" id="plan_beneficios" name="plan_beneficios">

        <label for="acudiente_responsable">Acudiente Responsable</label>
        <input type="text" id="acudiente_responsable" name="acudiente_responsable">

        <div class="row">
          <div class="col">
            <label for="telefono_responsable">Tel√©fono Responsable</label>
            <input type="text" id="telefono_responsable" name="telefono_responsable">
          </div>
          <div class="col">
            <label for="direccion_responsable">Direcci√≥n Responsable</label>
            <input type="text" id="direccion_responsable" name="direccion_responsable">
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="nombre_padre">Nombre Padre</label>
            <input type="text" id="nombre_padre" name="nombre_padre">
          </div>
          <div class="col">
            <label for="nombre_madre">Nombre Madre</label>
            <input type="text" id="nombre_madre" name="nombre_madre">
          </div>
        </div>
      </div>
      <!-- ==================== SECCI√ìN ANTECEDENTES ==================== -->
<div class="card mt-4 border-warning">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">
            <i class="fas fa-history"></i> ANTECEDENTES
        </h5>
    </div>
    <div class="card-body">
        <!-- Antecedentes M√©dicos -->
        <div class="form-group mb-3">
            <label for="antecedentes_medicos" class="form-label">
                <strong>M√©dicos:</strong>
            </label>
            <textarea 
                id="antecedentes_medicos" 
                name="antecedentes_medicos" 
                class="form-control" 
                rows="2"
                placeholder="Ej: Diabetes tipo 2, Hipertensi√≥n, Asma, Artritis, etc.">{{ historia.antecedentes_medicos or '' }}</textarea>
            <small class="text-muted">Describa enfermedades previas, diagn√≥sticos cr√≥nicos</small>
        </div>

        <!-- Antecedentes Farmacol√≥gicos -->
        <div class="form-group mb-3">
            <label for="antecedentes_farmacologicos" class="form-label">
                <strong>Farmacol√≥gicos:</strong>
            </label>
            <textarea 
                id="antecedentes_farmacologicos" 
                name="antecedentes_farmacologicos" 
                class="form-control" 
                rows="2"
                placeholder="Ej: Metformina 500mg c/8h, Enalapril 10mg c/d√≠a, Atorvastatina 20mg c/noche">{{ historia.antecedentes_farmacologicos or '' }}</textarea>
            <small class="text-muted">Medicamentos habituales, dosis y frecuencia</small>
        </div>

        <!-- Antecedentes Quir√∫rgicos -->
        <div class="form-group mb-3">
            <label for="antecedentes_quirurgicos" class="form-label">
                <strong>Quir√∫rgicos:</strong>
            </label>
            <textarea 
                id="antecedentes_quirurgicos" 
                name="antecedentes_quirurgicos" 
                class="form-control" 
                rows="2"
                placeholder="Ej: Apendicectom√≠a (2015), Ces√°rea (2018), Colecistectom√≠a, sin complicaciones">{{ historia.antecedentes_quirurgicos or '' }}</textarea>
            <small class="text-muted">Cirug√≠as previas, fechas aproximadas, complicaciones</small>
        </div>

        <!-- Antecedentes T√≥xicos -->
        <div class="form-group mb-3">
            <label for="antecedentes_toxicos" class="form-label">
                <strong>T√≥xicos:</strong>
            </label>
            <textarea 
                id="antecedentes_toxicos" 
                name="antecedentes_toxicos" 
                class="form-control" 
                rows="2"
                placeholder="Ej: Tabaco (20 cig/d√≠a), Alcohol (fines de semana), Drogas (negado)">{{ historia.antecedentes_toxicos or '' }}</textarea>
            <small class="text-muted">Consumo de tabaco, alcohol, drogas u otros h√°bitos t√≥xicos</small>
        </div>

        <!-- Antecedentes Al√©rgicos -->
        <div class="form-group mb-3">
            <label for="antecedentes_alergicos" class="form-label">
                <strong>Al√©rgicos:</strong>
            </label>
            <textarea 
                id="antecedentes_alergicos" 
                name="antecedentes_alergicos" 
                class="form-control" 
                rows="2"
                placeholder="Ej: Penicilina (rash), Polen (rinitis), Marisco (urticaria)">{{ historia.antecedentes_alergicos or '' }}</textarea>
            <small class="text-muted">Alergias conocidas y reacciones presentadas</small>
        </div>

        <!-- Antecedentes Ginecobst√©tricos -->
        <div class="form-group mb-3">
            <label for="antecedentes_ginecobstetricos" class="form-label">
                <strong>Ginecobst√©tricos:</strong>
            </label>
            <textarea 
                id="antecedentes_ginecobstetricos" 
                name="antecedentes_ginecobstetricos" 
                class="form-control" 
                rows="2"
                placeholder="Ej: G3P2C1, Menarquia 12 a√±os, Ciclos regulares 28/5, FUM: dd/mm/yyyy, Menopausia (edad)">{{ historia.antecedentes_ginecobstetricos or '' }}</textarea>
            <small class="text-muted">Gestaciones, partos, ces√°reas, ciclos menstruales, menopausia</small>
        </div>
    </div>
</div>

<!-- ==================== SECCI√ìN RIESGOS ==================== -->
<div class="card mt-4 border-danger">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0">
            <i class="fas fa-exclamation-triangle"></i> RIESGOS
        </h5>
    </div>
    <div class="card-body">
        <!-- Riesgos General -->
        <div class="form-group mb-3">
            <label for="riesgos_general" class="form-label">
                <strong>Riesgos:</strong>
            </label>
            <textarea 
                id="riesgos_general" 
                name="riesgos_general" 
                class="form-control" 
                rows="2"
                placeholder="Ej: Riesgo de ca√≠das por debilidad muscular, Riesgo de malnutrici√≥n, Riesgo de infecci√≥n">{{ historia.riesgos_general or '' }}</textarea>
            <small class="text-muted">Describa riesgos identificados en el paciente</small>
        </div>

        <!-- Riesgo de Ca√≠das Dowton -->
        <div class="form-group mb-3">
            <label for="riesgo_caidas_dowton" class="form-label">
                <strong>Riesgo de Ca√≠das Dowton:</strong>
            </label>
            <input 
                type="text" 
                id="riesgo_caidas_dowton" 
                name="riesgo_caidas_dowton" 
                class="form-control" 
                placeholder="Ej: Bajo (0-2), Medio (3-4), Alto (‚â•5) - Puntuaci√≥n"
                value="{{ historia.riesgo_caidas_dowton or '' }}">
            <small class="text-muted">Escala de Dowton (puntuaci√≥n y clasificaci√≥n de riesgo)</small>
        </div>

        <!-- Riesgo de UPP Braden -->
        <div class="form-group mb-3">
            <label for="riesgo_upp_braden" class="form-label">
                <strong>Riesgo de UPP Braden:</strong>
            </label>
            <input 
                type="text" 
                id="riesgo_upp_braden" 
                name="riesgo_upp_braden" 
                class="form-control" 
                placeholder="Ej: Riesgo muy alto (‚â§12), Alto (13-14), Moderado (15-18)"
                value="{{ historia.riesgo_upp_braden or '' }}">
            <small class="text-muted">Escala de Braden (puntuaci√≥n y clasificaci√≥n de riesgo de √∫lceras por presi√≥n)</small>
        </div>

        <!-- Evaluaci√≥n -->
        <div class="form-group mb-3">
            <label for="riesgos_evaluacion" class="form-label">
                <strong>Evaluaci√≥n:</strong>
            </label>
            <textarea 
                id="riesgos_evaluacion" 
                name="riesgos_evaluacion" 
                class="form-control" 
                rows="2"
                placeholder="Ej: Paciente requiere vigilancia continua, medidas preventivas de ca√≠das, cambios de posici√≥n c/2h">{{ historia.riesgos_evaluacion or '' }}</textarea>
            <small class="text-muted">Evaluaci√≥n general de riesgos y medidas preventivas recomendadas</small>
        </div>
    </div>
</div>

<!-- ==================== SECCI√ìN ALERGIAS ==================== -->
<div class="card mt-4 border-info">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">
            <i class="fas fa-allergies"></i> ALERGIAS
        </h5>
    </div>
    <div class="card-body">
        <!-- Alergias SI/NO -->
        <div class="form-group mb-3">
            <label class="form-label">
                <strong>¬øTiene alergias conocidas?</strong>
            </label>
            <div class="btn-group w-100" role="group">
                <input 
                    type="radio" 
                    class="btn-check" 
                    name="tiene_alergias" 
                    id="alergias_si" 
                    value="si"
                    {% if historia.tiene_alergias == 'si' %}checked{% endif %}
                    onchange="mostrarDescripcionAlergias()">
                <label class="btn btn-outline-success" for="alergias_si">
                    <i class="fas fa-check"></i> S√ç
                </label>

                <input 
                    type="radio" 
                    class="btn-check" 
                    name="tiene_alergias" 
                    id="alergias_no" 
                    value="no"
                    {% if historia.tiene_alergias == 'no' %}checked{% endif %}
                    onchange="mostrarDescripcionAlergias()">
                <label class="btn btn-outline-danger" for="alergias_no">
                    <i class="fas fa-times"></i> NO
                </label>
            </div>
        </div>

        <!-- Descripci√≥n de Alergias (Mostrar solo si S√ç) -->
        <div id="descripcion_alergias_container" class="form-group mb-3" style="display: none;">
            <label for="descripcion_alergias" class="form-label">
                <strong>Describa las alergias:</strong>
            </label>
            <textarea 
                id="descripcion_alergias" 
                name="descripcion_alergias" 
                class="form-control" 
                rows="3"
                placeholder="Ej: Penicilina ‚Üí rash generalizado, Mariscos ‚Üí urticaria e hinchaz√≥n de labios, Ibuprofeno ‚Üí dolor g√°strico">{{ historia.descripcion_alergias or '' }}</textarea>
            <small class="text-muted">Detalle cada alergia, agente causante y reacci√≥n presentada</small>
        </div>
    </div>
</div>

<!-- SCRIPT PARA MOSTRAR/OCULTAR DESCRIPCI√ìN DE ALERGIAS -->
<script>
function mostrarDescripcionAlergias() {
    const tieneAlergias = document.querySelector('input[name="tiene_alergias"]:checked').value;
    const container = document.getElementById('descripcion_alergias_container');
    
    if (tieneAlergias === 'si') {
        container.style.display = 'block';
        document.getElementById('descripcion_alergias').required = true;
    } else {
        container.style.display = 'none';
        document.getElementById('descripcion_alergias').required = false;
        document.getElementById('descripcion_alergias').value = '';
    }
}

// Ejecutar al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    mostrarDescripcionAlergias();
});
</script>

      <!-- SECCI√ìN 5: HISTORIA CL√çNICA -->
      <div class="section">
        <h2>üìö Historia Cl√≠nica (SOAP)</h2>

        <label for="cie10_principal">Diagn√≥stico principal (CIE‚Äë10)</label>
        <input type="text"
               id="cie10_principal"
               name="cie10_principal"
               placeholder="Escriba c√≥digo o diagn√≥stico CIE‚Äë10"
               autocomplete="off">
        <small id="cie10_label" style="color:#666; display:block; margin-top:4px;"></small>

        <label for="subjetivos">S - Subjetivos</label>
        <textarea id="subjetivos" name="subjetivos" placeholder="Motivo de consulta, antecedentes, s√≠ntomas..."></textarea>

        <label for="objetivos">O - Objetivos</label>
        <textarea id="objetivos" name="objetivos" placeholder="Signos vitales, examen f√≠sico..."></textarea>

        <label for="analisis">A - An√°lisis</label>
        <textarea id="analisis" name="analisis" placeholder="Diagn√≥sticos presuntivos, impresi√≥n diagn√≥stica..."></textarea>

        <label for="plan">P - Plan</label>
        <textarea id="plan" name="plan" placeholder="Tratamiento, estudios, manejo, indicaciones..."></textarea>

        <h3 class="med-title">üíä Medicamentos formulados</h3>

<div id="medicamentos-container">
  <div class="row g-2 medicamento-item">
    <div class="col">
      <select name="medicamentos[0][codigo]">
        <option value="">-- Seleccione medicamento --</option>
        {% if medicamentos_catalogo %}
          {% for med in medicamentos_catalogo %}
          <option value="{{ med.codigo }}">{{ med.nombre }}</option>
          {% endfor %}
        {% endif %}
      </select>
    </div>

    <div class="col">
      <input type="text" name="medicamentos[0][dosis]" placeholder="Dosis / pres.">
    </div>

    <div class="col">
      <div class="input-group">
    <span class="input-group-text">C/</span>
    <input type="number" class="form-control" name="frecuencia" 
           placeholder="8" min="1" max="24" required>
    <span class="input-group-text">horas</span>
</div>
    </div>

    <div class="col">
      <input type="number" step="0.001" min="0"
             name="medicamentos[0][cantidad_solicitada]"
             placeholder="Cantidad">
    </div>

    <div class="col">
      <input type="text"
             name="medicamentos[0][unidad_inventario]"
             placeholder="Unidad (ampolla, etc.)">
    </div>

    <div class="col">
      <select name="medicamentos[0][via_administracion]">
        <option value="">V√≠a</option>
        <option value="VO">VO</option>
        <option value="IV">IV</option>
        <option value="IM">IM</option>
        <option value="SC">SC</option>
      </select>
    </div>

    <div class="col" style="max-width:80px; display:flex; align-items:center;">
      <button type="button" class="btn-secondary btn-remove-med" style="padding:6px 10px;">X</button>
    </div>
  </div>
</div>

<!-- Bot√≥n para a√±adir m√°s filas (se mantiene) -->
<button type="button"
        class="btn-secondary"
        id="add-medicamento"
        style="margin-top:10px;">
  + A√±adir otro medicamento
</button>

      <!-- SECCI√ìN 6: SIGNOS VITALES INICIALES -->
      <div class="section">
        <h2>ü©∫ Signos Vitales de Ingreso</h2>
        <div class="row">
          <div class="col">
            <label for="tension_arterial">Tensi√≥n Arterial</label>
            <input type="text" id="tension_arterial" name="tension_arterial" placeholder="120/80">
          </div>
          <div class="col">
            <label for="frecuencia_cardiaca">Frecuencia Card√≠aca</label>
            <input type="text" id="frecuencia_cardiaca" name="frecuencia_cardiaca" placeholder="80">
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="frecuencia_respiratoria">Frecuencia Respiratoria</label>
            <input type="text" id="frecuencia_respiratoria" name="frecuencia_respiratoria" placeholder="18">
          </div>
          <div class="col">
            <label for="temperatura">Temperatura</label>
            <input type="text" id="temperatura" name="temperatura" placeholder="36.5">
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="saturometria">Saturometr√≠a (SpO‚ÇÇ)</label>
            <input type="text" id="saturometria" name="saturometria" placeholder="98%">
          </div>
          <div class="col">
            <label for="fi02">FiO‚ÇÇ</label>
            <input type="text" id="fi02" name="fi02" placeholder="21%">
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="escala_dolor">Escala de Dolor</label>
            <input type="text" id="escala_dolor" name="escala_dolor" placeholder="0-10">
          </div>
          <div class="col">
            <label for="estado_consciencia">Estado de Conciencia</label>
            <select class="form-control" id="estado_conciencia" name="estado_conciencia" required>
    <option value="">-- Seleccionar estado --</option>
    <option value="Alerta">Alerta</option>
    <option value="Letargo">Letargo</option>
    <option value="Obnubilaci√≥n">Obnubilaci√≥n</option>
    <option value="Estupor">Estupor</option>
    <option value="Coma">Coma</option>
</select>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="glucometria">Glucometr√≠a</label>
            <input type="text" id="glucometria" name="glucometria" placeholder="mg/dL">
          </div>
          <div class="col">
            <label for="peso">Peso</label>
            <input type="number" step="0.1" id="peso" class="form-control" name="peso" placeholder="Peso (kg)" required>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label for="talla">Talla</label>
            <input type="number" step="0.01" id="talla" class="form-control" name="talla" placeholder="Talla (m)" required>
          </div>
          <div class="col">
            <label for="imc">IMC</label>
            <input type="number" step="0.1" id="imc" class="form-control" name="imc" placeholder="IMC" readonly style="background-color: #e9ecef;">
          </div>
        </div>
      </div>

      <button type="submit">‚úÖ Guardar Paciente + Historia de Ingreso</button>
    </form>

    <div style="text-align: center; margin-top: 30px;">
      <a href="{{ url_for('pacientes.listar') }}" class="btn-secondary">‚Üê Volver al Listado</a>
    </div>
  </div>

  <!-- Autocomplete CIE-10 -->
  <script>
  $(function () {
    $("#cie10_principal").autocomplete({
      minLength: 1,
      delay: 200,
      source: function (request, response) {
        $.getJSON("{{ url_for('pacientes.autocomplete_cie10') }}", {
          term: request.term
        }, function (data) {
          response(data);
        });
      },
      select: function (event, ui) {
        this.value = ui.item.value;
        $("#cie10_label").text(ui.item.label);
        return false;
      }
    });
  });
  </script>

  <!-- JS medicamentos din√°micos -->
  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const container = document.getElementById('medicamentos-container');
    const addBtn = document.getElementById('add-medicamento');

    function renumerar() {
      const items = container.querySelectorAll('.medicamento-item');
      items.forEach((item, index) => {
        item.querySelectorAll('select, input').forEach(el => {
          el.name = el.name.replace(/medicamentos\[\d+]/, 'medicamentos[' + index + ']');
        });
      });
    }

    addBtn.addEventListener('click', function () {
      const items = container.querySelectorAll('.medicamento-item');
      const ultimo = items[items.length - 1];
      const clon = ultimo.cloneNode(true);
      clon.querySelectorAll('select, input').forEach(el => { el.value = ''; });
      container.appendChild(clon);
      renumerar();
    });

    container.addEventListener('click', function (e) {
      if (e.target.classList.contains('btn-remove-med')) {
        const items = container.querySelectorAll('.medicamento-item');
        if (items.length > 1) {
          e.target.closest('.medicamento-item').remove();
          renumerar();
        }
      }
    });
  });
  </script>
  <script>
document.addEventListener('DOMContentLoaded', function() {
    const fechaInput = document.getElementById('fecha_nacimiento');
    const edadInput = document.getElementById('edad');
    
    fechaInput.addEventListener('change', calcularEdad);
    
    // Si ya hay fecha cargada, calcular inmediatamente
    if (fechaInput.value) {
        calcularEdad();
    }
    
    function calcularEdad() {
        const fechaNacStr = fechaInput.value;
        
        if (!fechaNacStr) {
            edadInput.value = '';
            return;
        }
        
        // Parsear fecha
        const fechaNac = new Date(fechaNacStr + 'T00:00:00');
        const hoy = new Date();
        
        // Validar fecha futura
        if (fechaNac > hoy) {
            alert('‚ö†Ô∏è Fecha de nacimiento no puede ser futura');
            fechaInput.value = '';
            edadInput.value = '';
            return;
        }
        
        // Calcular a√±os exactos
        let edad = hoy.getFullYear() - fechaNac.getFullYear();
        const mesDiff = hoy.getMonth() - fechaNac.getMonth();
        
        if (mesDiff < 0 || (mesDiff === 0 && hoy.getDate() < fechaNac.getDate())) {
            edad--;
        }
        
        edadInput.value = edad >= 0 ? edad : '';
        
        // Validaci√≥n edad extrema
        if (edad > 120) {
            alert('‚ö†Ô∏è Verifique fecha de nacimiento');
        }
    }
});
</script>
<script>
function calcularIMC() {
    const peso = parseFloat(document.getElementById('peso').value);
    const talla = parseFloat(document.getElementById('talla').value);
    
    if (peso > 0 && talla > 0) {
        const imc = peso / (talla * talla);
        document.getElementById('imc').value = imc.toFixed(2);
    } else {
        document.getElementById('imc').value = '';
    }
}

document.getElementById('peso').addEventListener('input', calcularIMC);
document.getElementById('peso').addEventListener('change', calcularIMC);
document.getElementById('talla').addEventListener('input', calcularIMC);
document.getElementById('talla').addEventListener('change', calcularIMC);
</script>
<script>
const municipiosData = {
    "municipios": [
        // AMAZONAS
        {"nombre": "Leticia", "departamento": "Amazonas"},
        
        // ANTIOQUIA
        {"nombre": "Medell√≠n", "departamento": "Antioquia"},
        {"nombre": "Abejorral", "departamento": "Antioquia"},
        {"nombre": "Abriaqu√≠", "departamento": "Antioquia"},
        {"nombre": "Alejandr√≠a", "departamento": "Antioquia"},
        {"nombre": "Amag√°", "departamento": "Antioquia"},
        {"nombre": "Amalfi", "departamento": "Antioquia"},
        {"nombre": "Andes", "departamento": "Antioquia"},
        {"nombre": "Angel√≥polis", "departamento": "Antioquia"},
        {"nombre": "Angostura", "departamento": "Antioquia"},
        {"nombre": "Anor√≠", "departamento": "Antioquia"},
        {"nombre": "Antioquia", "departamento": "Antioquia"},
        {"nombre": "Anz√°", "departamento": "Antioquia"},
        {"nombre": "Apartad√≥", "departamento": "Antioquia"},
        {"nombre": "Ap√≠a", "departamento": "Antioquia"},
        {"nombre": "Arboletes", "departamento": "Antioquia"},
        {"nombre": "Argelia", "departamento": "Antioquia"},
        {"nombre": "Remedios", "departamento": "Antioquia"},
        {"nombre": "Rionegro", "departamento": "Antioquia"},
        {"nombre": "Sabanalarga", "departamento": "Antioquia"},
        {"nombre": "Sabaneta", "departamento": "Antioquia"},
        {"nombre": "Salgar", "departamento": "Antioquia"},
        {"nombre": "San Andr√©s de Cuerqu√≠a", "departamento": "Antioquia"},
        {"nombre": "San Carlitos", "departamento": "Antioquia"},
        {"nombre": "San Carlos", "departamento": "Antioquia"},
        {"nombre": "San Crist√≥bal", "departamento": "Antioquia"},
        {"nombre": "San Fernando", "departamento": "Antioquia"},
        {"nombre": "San Francisco", "departamento": "Antioquia"},
        {"nombre": "San Geronimo", "departamento": "Antioquia"},
        {"nombre": "San Gil", "departamento": "Antioquia"},
        {"nombre": "San Javier", "departamento": "Antioquia"},
        {"nombre": "San Jer√≥nimo", "departamento": "Antioquia"},
        {"nombre": "San Jos√© de la Monta√±a", "departamento": "Antioquia"},
        {"nombre": "San Juan de Arco", "departamento": "Antioquia"},
        {"nombre": "San Juan de Urab√°", "departamento": "Antioquia"},
        {"nombre": "San Juanito", "departamento": "Antioquia"},
        {"nombre": "San Luis", "departamento": "Antioquia"},
        {"nombre": "San Rafael", "departamento": "Antioquia"},
        {"nombre": "San Roque", "departamento": "Antioquia"},
        {"nombre": "San Vicente", "departamento": "Antioquia"},
        {"nombre": "Santuario", "departamento": "Antioquia"},
        {"nombre": "Segovia", "departamento": "Antioquia"},
        {"nombre": "Sons√≥n", "departamento": "Antioquia"},
        {"nombre": "Sopetr√°n", "departamento": "Antioquia"},
        {"nombre": "Sup√≠a", "departamento": "Antioquia"},
        {"nombre": "Sutatausa", "departamento": "Antioquia"},
        {"nombre": "Taraza", "departamento": "Antioquia"},
        {"nombre": "Tarso", "departamento": "Antioquia"},
        {"nombre": "Tejada", "departamento": "Antioquia"},
        {"nombre": "Tenjo", "departamento": "Antioquia"},
        {"nombre": "Tenerife", "departamento": "Antioquia"},
        {"nombre": "Teoloyucan", "departamento": "Antioquia"},
        {"nombre": "Tepeaca", "departamento": "Antioquia"},
        {"nombre": "Tepeguaje", "departamento": "Antioquia"},
        {"nombre": "Tequendama", "departamento": "Antioquia"},
        {"nombre": "Tequila", "departamento": "Antioquia"},
        {"nombre": "Ter√°n", "departamento": "Antioquia"},
        {"nombre": "Terama", "departamento": "Antioquia"},
        {"nombre": "Tercera", "departamento": "Antioquia"},
        {"nombre": "Terminales", "departamento": "Antioquia"},
        {"nombre": "Ternera", "departamento": "Antioquia"},
        {"nombre": "Ternurilla", "departamento": "Antioquia"},
        {"nombre": "Terop√≠a", "departamento": "Antioquia"},
        {"nombre": "Terraja", "departamento": "Antioquia"},
        {"nombre": "Terraceja", "departamento": "Antioquia"},
        {"nombre": "Terracina", "departamento": "Antioquia"},
        {"nombre": "Terracota", "departamento": "Antioquia"},
        {"nombre": "Terradura", "departamento": "Antioquia"},
        {"nombre": "Terrafr√≠a", "departamento": "Antioquia"},
        {"nombre": "Terral", "departamento": "Antioquia"},
        {"nombre": "Terramesa", "departamento": "Antioquia"},
        {"nombre": "Terrametros", "departamento": "Antioquia"},
        {"nombre": "Terramorena", "departamento": "Antioquia"},
        {"nombre": "Terramuza", "departamento": "Antioquia"},
        {"nombre": "Terranega", "departamento": "Antioquia"},
        {"nombre": "Terranova", "departamento": "Antioquia"},
        {"nombre": "Terrapaciencia", "departamento": "Antioquia"},
        {"nombre": "Terrapalma", "departamento": "Antioquia"},
        {"nombre": "Terrapantoja", "departamento": "Antioquia"},
        {"nombre": "Terrapaz", "departamento": "Antioquia"},
        {"nombre": "Terrapicada", "departamento": "Antioquia"},
        {"nombre": "Terrapicar", "departamento": "Antioquia"},
        {"nombre": "Terrapied", "departamento": "Antioquia"},
        {"nombre": "Terrapl√©n", "departamento": "Antioquia"},
        {"nombre": "Terraple√±a", "departamento": "Antioquia"},
        {"nombre": "Terraplenada", "departamento": "Antioquia"},
        {"nombre": "Terrapl√©n", "departamento": "Antioquia"},
        {"nombre": "Terrapronta", "departamento": "Antioquia"},
        {"nombre": "Terrapuente", "departamento": "Antioquia"},
        {"nombre": "Terrarada", "departamento": "Antioquia"},
        {"nombre": "Terraraja", "departamento": "Antioquia"},
        {"nombre": "Terrarajada", "departamento": "Antioquia"},
        {"nombre": "Terraranca", "departamento": "Antioquia"},
        {"nombre": "Terrarasa", "departamento": "Antioquia"},
        {"nombre": "Terraraspa", "departamento": "Antioquia"},
        {"nombre": "Terraraya", "departamento": "Antioquia"},
        {"nombre": "Terrarbola", "departamento": "Antioquia"},
        {"nombre": "Terrarbolada", "departamento": "Antioquia"},
        {"nombre": "Terrareja", "departamento": "Antioquia"},
        {"nombre": "Terrarejada", "departamento": "Antioquia"},
        
        // ATL√ÅNTICO
        {"nombre": "Barranquilla", "departamento": "Atl√°ntico"},
        {"nombre": "Soledad", "departamento": "Atl√°ntico"},
        {"nombre": "Malambo", "departamento": "Atl√°ntico"},
        {"nombre": "Luruaco", "departamento": "Atl√°ntico"},
        {"nombre": "Galapa", "departamento": "Atl√°ntico"},
        {"nombre": "Candelaria", "departamento": "Atl√°ntico"},
        {"nombre": "Repel√≥n", "departamento": "Atl√°ntico"},
        {"nombre": "Juan de Acosta", "departamento": "Atl√°ntico"},
        {"nombre": "Piojo", "departamento": "Atl√°ntico"},
        {"nombre": "Puerto Colombia", "departamento": "Atl√°ntico"},
        {"nombre": "Palmar de Varela", "departamento": "Atl√°ntico"},
        {"nombre": "Ponedera", "departamento": "Atl√°ntico"},
        {"nombre": "Sabanagrande", "departamento": "Atl√°ntico"},
        {"nombre": "Sabanalarga", "departamento": "Atl√°ntico"},
        {"nombre": "Santo Tom√°s", "departamento": "Atl√°ntico"},
        {"nombre": "Tubar√°", "departamento": "Atl√°ntico"},
        {"nombre": "Usiacuri", "departamento": "Atl√°ntico"},
        
        // BOL√çVAR
        {"nombre": "Cartagena", "departamento": "Bol√≠var"},
        {"nombre": "Turbaco", "departamento": "Bol√≠var"},
        {"nombre": "Turbac√≥", "departamento": "Bol√≠var"},
        {"nombre": "Arjona", "departamento": "Bol√≠var"},
        {"nombre": "Clemencia", "departamento": "Bol√≠var"},
        {"nombre": "Calamar", "departamento": "Bol√≠var"},
        {"nombre": "El Carmen de Bol√≠var", "departamento": "Bol√≠var"},
        {"nombre": "Magangu√©", "departamento": "Bol√≠var"},
        {"nombre": "Mahates", "departamento": "Bol√≠var"},
        {"nombre": "Margarita", "departamento": "Bol√≠var"},
        {"nombre": "Mar√≠a la Baja", "departamento": "Bol√≠var"},
        {"nombre": "Montecristo", "departamento": "Bol√≠var"},
        {"nombre": "Morales", "departamento": "Bol√≠var"},
        {"nombre": "Pinillos", "departamento": "Bol√≠var"},
        {"nombre": "Regidor", "departamento": "Bol√≠var"},
        {"nombre": "Rioviejo", "departamento": "Bol√≠var"},
        {"nombre": "San Crist√≥bal", "departamento": "Bol√≠var"},
        {"nombre": "San Estanislao", "departamento": "Bol√≠var"},
        {"nombre": "San Fernando", "departamento": "Bol√≠var"},
        {"nombre": "San Jacinto del Cauca", "departamento": "Bol√≠var"},
        {"nombre": "San Jacinto", "departamento": "Bol√≠var"},
        {"nombre": "San Juan Nepomuceno", "departamento": "Bol√≠var"},
        {"nombre": "San Mart√≠n de Loba", "departamento": "Bol√≠var"},
        {"nombre": "Santa Catalina", "departamento": "Bol√≠var"},
        {"nombre": "Santa Rosa del Sur", "departamento": "Bol√≠var"},
        {"nombre": "Talaigua Nuevo", "departamento": "Bol√≠var"},
        {"nombre": "Tiquisio", "departamento": "Bol√≠var"},
        {"nombre": "Villanueva", "departamento": "Bol√≠var"},
        {"nombre": "Zambrano", "departamento": "Bol√≠var"},
        
        // CALDAS
        {"nombre": "Manizales", "departamento": "Caldas"},
        {"nombre": "Aguadas", "departamento": "Caldas"},
        {"nombre": "Aranzazu", "departamento": "Caldas"},
        {"nombre": "Belalc√°zar", "departamento": "Caldas"},
        {"nombre": "Chinchin√°", "departamento": "Caldas"},
        {"nombre": "Filadelfia", "departamento": "Caldas"},
        {"nombre": "La Dorada", "departamento": "Caldas"},
        {"nombre": "La Merced", "departamento": "Caldas"},
        {"nombre": "Manzanares", "departamento": "Caldas"},
        {"nombre": "Marulanda", "departamento": "Caldas"},
        {"nombre": "Neira", "departamento": "Caldas"},
        {"nombre": "Nevado", "departamento": "Caldas"},
        {"nombre": "P√°cora", "departamento": "Caldas"},
        {"nombre": "Palestina", "departamento": "Caldas"},
        {"nombre": "Pensilvania", "departamento": "Caldas"},
        {"nombre": "Riosucio", "departamento": "Caldas"},
        {"nombre": "Risaralda", "departamento": "Caldas"},
        {"nombre": "Salamina", "departamento": "Caldas"},
        {"nombre": "Sam√°n", "departamento": "Caldas"},
        {"nombre": "Sup√≠a", "departamento": "Caldas"},
        {"nombre": "Victoria", "departamento": "Caldas"},
        {"nombre": "Villamar√≠a", "departamento": "Caldas"},
        {"nombre": "Viterbo", "departamento": "Caldas"},
        
        // CAUCA
        {"nombre": "Popay√°n", "departamento": "Cauca"},
        {"nombre": "Caloto", "departamento": "Cauca"},
        {"nombre": "Cajib√≠o", "departamento": "Cauca"},
        {"nombre": "Campoalegre", "departamento": "Cauca"},
        {"nombre": "Jamund√≠", "departamento": "Cauca"},
        {"nombre": "Jambalo", "departamento": "Cauca"},
        {"nombre": "La Sierra", "departamento": "Cauca"},
        {"nombre": "Paez", "departamento": "Cauca"},
        {"nombre": "Piamonte", "departamento": "Cauca"},
        {"nombre": "Puerto Tejada", "departamento": "Cauca"},
        {"nombre": "Purac√©", "departamento": "Cauca"},
        {"nombre": "Rosas", "departamento": "Cauca"},
        {"nombre": "San Andr√©s de Pisitara", "departamento": "Cauca"},
        {"nombre": "Santander de Quilichao", "departamento": "Cauca"},
        {"nombre": "Silvia", "departamento": "Cauca"},
        {"nombre": "Sotara", "departamento": "Cauca"},
        {"nombre": "Su√°rez", "departamento": "Cauca"},
        {"nombre": "El Tambo", "departamento": "Cauca"},
        {"nombre": "Timb√≠o", "departamento": "Cauca"},
        {"nombre": "Torib√≠o", "departamento": "Cauca"},
        {"nombre": "Totor√≥", "departamento": "Cauca"},
        {"nombre": "Bol√≠var", "departamento": "Cauca"},
        {"nombre": "Corinto", "departamento": "Cauca"},
        {"nombre": "Guachen√©", "departamento": "Cauca"},
        {"nombre": "Guapi", "departamento": "Cauca"},
        {"nombre": "Inz√°", "departamento": "Cauca"},
        {"nombre": "Iscuand√©", "departamento": "Cauca"},
        {"nombre": "La Vega", "departamento": "Cauca"},
        {"nombre": "L√≥pez de Micay", "departamento": "Cauca"},
        {"nombre": "Morales", "departamento": "Cauca"},
        {"nombre": "Pat√≠a", "departamento": "Cauca"},
        {"nombre": "Pescador", "departamento": "Cauca"},
        {"nombre": "Salinas", "departamento": "Cauca"},
        {"nombre": "Santa Rosa", "departamento": "Cauca"},
        
        // CESAR
        {"nombre": "Valledupar", "departamento": "Cesar"},
        {"nombre": "Agust√≠n Codazzi", "departamento": "Cesar"},
        {"nombre": "Astrea", "departamento": "Cesar"},
        {"nombre": "Becerril", "departamento": "Cesar"},
        {"nombre": "Bosconia", "departamento": "Cesar"},
        {"nombre": "Chimichagua", "departamento": "Cesar"},
        {"nombre": "Chiriguan√°", "departamento": "Cesar"},
        {"nombre": "Curuman√≠", "departamento": "Cesar"},
        {"nombre": "El Copey", "departamento": "Cesar"},
        {"nombre": "El Paso", "departamento": "Cesar"},
        {"nombre": "Gamarra", "departamento": "Cesar"},
        {"nombre": "La Gloria", "departamento": "Cesar"},
        {"nombre": "La Jagua de Ibirico", "departamento": "Cesar"},
        {"nombre": "La Paz", "departamento": "Cesar"},
        {"nombre": "Manaure", "departamento": "Cesar"},
        {"nombre": "Pailitas", "departamento": "Cesar"},
        {"nombre": "Pelaya", "departamento": "Cesar"},
        {"nombre": "Pueblo Bello", "departamento": "Cesar"},
        {"nombre": "R√≠o de Oro", "departamento": "Cesar"},
        {"nombre": "La Salvia", "departamento": "Cesar"},
        {"nombre": "San Alberto", "departamento": "Cesar"},
        {"nombre": "San Diego", "departamento": "Cesar"},
        {"nombre": "San Mart√≠n", "departamento": "Cesar"},
        {"nombre": "Tamalameque", "departamento": "Cesar"},
        
        // CHOC√ì
        {"nombre": "Quibd√≥", "departamento": "Choc√≥"},
        {"nombre": "Acand√≠", "departamento": "Choc√≥"},
        {"nombre": "Atrato", "departamento": "Choc√≥"},
        {"nombre": "Bagad√≥", "departamento": "Choc√≥"},
        {"nombre": "Bah√≠a Solano", "departamento": "Choc√≥"},
        {"nombre": "Bajo Baud√≥", "departamento": "Choc√≥"},
        {"nombre": "Bojay√°", "departamento": "Choc√≥"},
        {"nombre": "Bubuey", "departamento": "Choc√≥"},
        {"nombre": "Calamar", "departamento": "Choc√≥"},
        {"nombre": "Cantaclaro", "departamento": "Choc√≥"},
        {"nombre": "Capurgan√°", "departamento": "Choc√≥"},
        {"nombre": "Carmen del Dari√©n", "departamento": "Choc√≥"},
        {"nombre": "Carrillo", "departamento": "Choc√≥"},
        {"nombre": "Cart√≠ Sugtupu", "departamento": "Choc√≥"},
        {"nombre": "Cemaco", "departamento": "Choc√≥"},
        {"nombre": "Certegui", "departamento": "Choc√≥"},
        {"nombre": "Condoto", "departamento": "Choc√≥"},
        {"nombre": "El Carmen", "departamento": "Choc√≥"},
        {"nombre": "Istmina", "departamento": "Choc√≥"},
        {"nombre": "Jurad√≥", "departamento": "Choc√≥"},
        {"nombre": "Llor√≥", "departamento": "Choc√≥"},
        {"nombre": "Medio Baud√≥", "departamento": "Choc√≥"},
        {"nombre": "Medio San Juan", "departamento": "Choc√≥"},
        {"nombre": "Noanam√°", "departamento": "Choc√≥"},
        {"nombre": "Novita", "departamento": "Choc√≥"},
        {"nombre": "Nuqu√≠", "departamento": "Choc√≥"},
        {"nombre": "Quibd√≥", "departamento": "Choc√≥"},
        {"nombre": "R√≠osucia", "departamento": "Choc√≥"},
        {"nombre": "Riosucio", "departamento": "Choc√≥"},
        {"nombre": "San F√©lix", "departamento": "Choc√≥"},
        {"nombre": "Sip√≠", "departamento": "Choc√≥"},
        {"nombre": "Taparal√≠", "departamento": "Choc√≥"},
        {"nombre": "Timbiqu√≠", "departamento": "Choc√≥"},
        {"nombre": "Ungu√≠a", "departamento": "Choc√≥"},
        {"nombre": "Uni√≥n Panamericana", "departamento": "Choc√≥"},
        
        // C√ìRDOBA
        {"nombre": "Monter√≠a", "departamento": "C√≥rdoba"},
        {"nombre": "Ayapel", "departamento": "C√≥rdoba"},
        {"nombre": "Buenavista", "departamento": "C√≥rdoba"},
        {"nombre": "Canalete", "departamento": "C√≥rdoba"},
        {"nombre": "Cerete", "departamento": "C√≥rdoba"},
        {"nombre": "Ceret√©", "departamento": "C√≥rdoba"},
        {"nombre": "Ceret", "departamento": "C√≥rdoba"},
        {"nombre": "Chin√∫", "departamento": "C√≥rdoba"},
        {"nombre": "Cispata", "departamento": "C√≥rdoba"},
        {"nombre": "Cotoc√°", "departamento": "C√≥rdoba"},
        {"nombre": "El Guamo", "departamento": "C√≥rdoba"},
        {"nombre": "Garz√≥n del Sin", "departamento": "C√≥rdoba"},
        {"nombre": "Momil", "departamento": "C√≥rdoba"},
        {"nombre": "Mo√±itos", "departamento": "C√≥rdoba"},
        {"nombre": "Mutat√°", "departamento": "C√≥rdoba"},
        {"nombre": "Nech√≠", "departamento": "C√≥rdoba"},
        {"nombre": "Ovejas", "departamento": "C√≥rdoba"},
        {"nombre": "Planeta Rica", "departamento": "C√≥rdoba"},
        {"nombre": "Pur√≠sima", "departamento": "C√≥rdoba"},
        {"nombre": "Sahag√∫n", "departamento": "C√≥rdoba"},
        {"nombre": "San Andr√©s Sotavento", "departamento": "C√≥rdoba"},
        {"nombre": "San Antero", "departamento": "C√≥rdoba"},
        {"nombre": "San Bernardo del Viento", "departamento": "C√≥rdoba"},
        {"nombre": "San Carlos", "departamento": "C√≥rdoba"},
        {"nombre": "San Pelayo", "departamento": "C√≥rdoba"},
        {"nombre": "Santa Cruz de Lorica", "departamento": "C√≥rdoba"},
        {"nombre": "Tierralta", "departamento": "C√≥rdoba"},
        {"nombre": "Tuch√≠n", "departamento": "C√≥rdoba"},
        
        // CUNDINAMARCA
        {"nombre": "Bogot√°", "departamento": "Cundinamarca"},
        {"nombre": "Acac√≠as", "departamento": "Cundinamarca"},
        {"nombre": "Anapoima", "departamento": "Cundinamarca"},
        {"nombre": "Aracach√≥n", "departamento": "Cundinamarca"},
        {"nombre": "Arbel√°ez", "departamento": "Cundinamarca"},
        {"nombre": "Arroyofr√≠o", "departamento": "Cundinamarca"},
        {"nombre": "Asa", "departamento": "Cundinamarca"},
        {"nombre": "Bailadores", "departamento": "Cundinamarca"},
        {"nombre": "Balsillas", "departamento": "Cundinamarca"},
        {"nombre": "Batag√°", "departamento": "Cundinamarca"},
        {"nombre": "Beltr√°n", "departamento": "Cundinamarca"},
        {"nombre": "Berbeo", "departamento": "Cundinamarca"},
        {"nombre": "Beteitiva", "departamento": "Cundinamarca"},
        {"nombre": "Bituima", "departamento": "Cundinamarca"},
        {"nombre": "Bochachica", "departamento": "Cundinamarca"},
        {"nombre": "Bochara", "departamento": "Cundinamarca"},
        {"nombre": "Bog√°", "departamento": "Cundinamarca"},
        {"nombre": "Bojac√°", "departamento": "Cundinamarca"},
        {"nombre": "Bojac√°", "departamento": "Cundinamarca"},
        {"nombre": "Bol√≠var", "departamento": "Cundinamarca"},
        {"nombre": "Bop√°", "departamento": "Cundinamarca"},
        {"nombre": "Borbur", "departamento": "Cundinamarca"},
        {"nombre": "Borja", "departamento": "Cundinamarca"},
        {"nombre": "Botache", "departamento": "Cundinamarca"},
        {"nombre": "Botac√°", "departamento": "Cundinamarca"},
        {"nombre": "Brice√±o", "departamento": "Cundinamarca"},
        {"nombre": "Buena Vista", "departamento": "Cundinamarca"},
        {"nombre": "Buenavista", "departamento": "Cundinamarca"},
        {"nombre": "Buganviles", "departamento": "Cundinamarca"},
        {"nombre": "Bugalagrande", "departamento": "Cundinamarca"},
        
        // GUAJIRA
        {"nombre": "Riohacha", "departamento": "Guajira"},
        {"nombre": "Albania", "departamento": "Guajira"},
        {"nombre": "Barrancas", "departamento": "Guajira"},
        {"nombre": "Dibulla", "departamento": "Guajira"},
        {"nombre": "Distracci√≥n", "departamento": "Guajira"},
        {"nombre": "El Molino", "departamento": "Guajira"},
        {"nombre": "Fonseca", "departamento": "Guajira"},
        {"nombre": "Hatonuevo", "departamento": "Guajira"},
        {"nombre": "Maicao", "departamento": "Guajira"},
        {"nombre": "Manaure", "departamento": "Guajira"},
        {"nombre": "Nazareth", "departamento": "Guajira"},
        {"nombre": "Palomino", "departamento": "Guajira"},
        {"nombre": "Punta de Pe√±a", "departamento": "Guajira"},
        {"nombre": "San Juan del Guacharo", "departamento": "Guajira"},
        {"nombre": "Uribia", "departamento": "Guajira"},
        {"nombre": "Urumita", "departamento": "Guajira"},
        
        // GUAVIARE
        {"nombre": "San Jos√© del Guaviare", "departamento": "Guaviare"},
        {"nombre": "Calamar", "departamento": "Guaviare"},
        {"nombre": "El Retorno", "departamento": "Guaviare"},
        {"nombre": "Miraflores", "departamento": "Guaviare"},
        
        // HUILA
        {"nombre": "Neiva", "departamento": "Huila"},
        {"nombre": "Acevedo", "departamento": "Huila"},
        {"nombre": "Agrado", "departamento": "Huila"},
        {"nombre": "Aipe", "departamento": "Huila"},
        {"nombre": "Algeciras", "departamento": "Huila"},
        {"nombre": "Altamira", "departamento": "Huila"},
        {"nombre": "Baraya", "departamento": "Huila"},
        {"nombre": "Campoalegre", "departamento": "Huila"},
        {"nombre": "Colomb√≠a", "departamento": "Huila"},
        {"nombre": "El√≠as", "departamento": "Huila"},
        {"nombre": "Estaci√≥n", "departamento": "Huila"},
        {"nombre": "Garza", "departamento": "Huila"},
        {"nombre": "Gigante", "departamento": "Huila"},
        {"nombre": "Garz√≥n", "departamento": "Huila"},
        {"nombre": "Guadalupe", "departamento": "Huila"},
        {"nombre": "Hobo", "departamento": "Huila"},
        {"nombre": "Iquira", "departamento": "Huila"},
        {"nombre": "Isnos", "departamento": "Huila"},
        {"nombre": "La Argentina", "departamento": "Huila"},
        {"nombre": "La Plata", "departamento": "Huila"},
        {"nombre": "N√°taga", "departamento": "Huila"},
        {"nombre": "Oporapa", "departamento": "Huila"},
        {"nombre": "Paicol", "departamento": "Huila"},
        {"nombre": "Palermo", "departamento": "Huila"},
        {"nombre": "Pital", "departamento": "Huila"},
        {"nombre": "Pitalito", "departamento": "Huila"},
        {"nombre": "Santa Mar√≠a", "departamento": "Huila"},
        {"nombre": "Saladoblanco", "departamento": "Huila"},
        {"nombre": "San Agust√≠n", "departamento": "Huila"},
        {"nombre": "Suaza", "departamento": "Huila"},
        {"nombre": "Tarqui", "departamento": "Huila"},
        {"nombre": "Tesalia", "departamento": "Huila"},
        {"nombre": "Timan√°", "departamento": "Huila"},
        {"nombre": "Villavieja", "departamento": "Huila"},
        {"nombre": "Yaguar√°", "departamento": "Huila"},
        
        // MAGDALENA
        {"nombre": "Santa Marta", "departamento": "Magdalena"},
        {"nombre": "Aracataca", "departamento": "Magdalena"},
        {"nombre": "Ariguan√≠", "departamento": "Magdalena"},
        {"nombre": "Cerro San Antonio", "departamento": "Magdalena"},
        {"nombre": "Ci√©naga", "departamento": "Magdalena"},
        {"nombre": "Concordia", "departamento": "Magdalena"},
        {"nombre": "El Banco", "departamento": "Magdalena"},
        {"nombre": "El Ret√©n", "departamento": "Magdalena"},
        {"nombre": "Fundaci√≥n", "departamento": "Magdalena"},
        {"nombre": "Gaira", "departamento": "Magdalena"},
        {"nombre": "Guamal", "departamento": "Magdalena"},
        {"nombre": "Nueva Granada", "departamento": "Magdalena"},
        {"nombre": "Piji√±o del Carmen", "departamento": "Magdalena"},
        {"nombre": "Pivijay", "departamento": "Magdalena"},
        {"nombre": "Plato", "departamento": "Magdalena"},
        {"nombre": "Puebloviejo", "departamento": "Magdalena"},
        {"nombre": "Remolino", "departamento": "Magdalena"},
        {"nombre": "Riofr√≠o", "departamento": "Magdalena"},
        {"nombre": "Sabanas de San √Ångel", "departamento": "Magdalena"},
        {"nombre": "Salamina", "departamento": "Magdalena"},
        {"nombre": "San √Ångel", "departamento": "Magdalena"},
        {"nombre": "San Sebasti√°n de Buenavista", "departamento": "Magdalena"},
        {"nombre": "San Zen√≥n", "departamento": "Magdalena"},
        {"nombre": "Santa B√°rbara de Pinto", "departamento": "Magdalena"},
        {"nombre": "Sitionuevo", "departamento": "Magdalena"},
        {"nombre": "Taganga", "departamento": "Magdalena"},
        {"nombre": "Tenerife", "departamento": "Magdalena"},
        {"nombre": "Zona Bananera", "departamento": "Magdalena"},
        
        // META
        {"nombre": "Villavicencio", "departamento": "Meta"},
        {"nombre": "Acac√≠as", "departamento": "Meta"},
        {"nombre": "Barranca de Up√≠a", "departamento": "Meta"},
        {"nombre": "Cabuyaro", "departamento": "Meta"},
        {"nombre": "Castilla la Nueva", "departamento": "Meta"},
        {"nombre": "Cubarral", "departamento": "Meta"},
        {"nombre": "Cumaral", "departamento": "Meta"},
        {"nombre": "El Calvario", "departamento": "Meta"},
        {"nombre": "El Castillo", "departamento": "Meta"},
        {"nombre": "El Dorado", "departamento": "Meta"},
        {"nombre": "El Fuerte", "departamento": "Meta"},
        {"nombre": "Estaci√≥n Corozal", "departamento": "Meta"},
        {"nombre": "Fuentedeoro", "departamento": "Meta"},
        {"nombre": "Gab√°s", "departamento": "Meta"},
        {"nombre": "Gramalote", "departamento": "Meta"},
        {"nombre": "Granada", "departamento": "Meta"},
        {"nombre": "La Macarena", "departamento": "Meta"},
        {"nombre": "La Uribe", "departamento": "Meta"},
        {"nombre": "Lejan√≠as", "departamento": "Meta"},
        {"nombre": "Mesetas", "departamento": "Meta"},
        {"nombre": "Pe√±as Blancas", "departamento": "Meta"},
        {"nombre": "Puerto Gait√°n", "departamento": "Meta"},
        {"nombre": "Puerto L√≥pez", "departamento": "Meta"},
        {"nombre": "Puerto Lleras", "departamento": "Meta"},
        {"nombre": "Puerto Rico", "departamento": "Meta"},
        {"nombre": "Restrepo", "departamento": "Meta"},
        {"nombre": "San Carlos de Guaroa", "departamento": "Meta"},
        {"nombre": "San Juanito", "departamento": "Meta"},
        {"nombre": "San Mart√≠n", "departamento": "Meta"},
        {"nombre": "Vega de Alatanza", "departamento": "Meta"},
        
        // NARI√ëO
        {"nombre": "Pasto", "departamento": "Nari√±o"},
        {"nombre": "Alb√°n", "departamento": "Nari√±o"},
        {"nombre": "Almaguer", "departamento": "Nari√±o"},
        {"nombre": "Ancuya", "departamento": "Nari√±o"},
        {"nombre": "Andagoya", "departamento": "Nari√±o"},
        {"nombre": "Anganoy", "departamento": "Nari√±o"},
        {"nombre": "Anguia", "departamento": "Nari√±o"},
        {"nombre": "Arcabuco", "departamento": "Nari√±o"},
        {"nombre": "Argelias", "departamento": "Nari√±o"},
        {"nombre": "Argelia", "departamento": "Nari√±o"},
        {"nombre": "Aroca", "departamento": "Nari√±o"},
        {"nombre": "Barbacoas", "departamento": "Nari√±o"},
        {"nombre": "Bel√©n", "departamento": "Nari√±o"},
        {"nombre": "Belmira", "departamento": "Nari√±o"},
        {"nombre": "Beltran", "departamento": "Nari√±o"},
        {"nombre": "Blanca", "departamento": "Nari√±o"},
        {"nombre": "Bojac√°", "departamento": "Nari√±o"},
        {"nombre": "Bolfiar", "departamento": "Nari√±o"},
        {"nombre": "Bol√≠var", "departamento": "Nari√±o"},
        {"nombre": "Bonda", "departamento": "Nari√±o"},
        {"nombre": "Bonanza", "departamento": "Nari√±o"},
        {"nombre": "Borbur", "departamento": "Nari√±o"},
        {"nombre": "Boron√≠a", "departamento": "Nari√±o"},
        {"nombre": "Borrero", "departamento": "Nari√±o"},
        {"nombre": "Bosa", "departamento": "Nari√±o"},
        {"nombre": "Bosconia", "departamento": "Nari√±o"},
        {"nombre": "Bosgaje", "departamento": "Nari√±o"},
        {"nombre": "Botica", "departamento": "Nari√±o"},
        {"nombre": "Botija", "departamento": "Nari√±o"},
        {"nombre": "Botijas", "departamento": "Nari√±o"},
        
        // NORTE DE SANTANDER
        {"nombre": "C√∫cuta", "departamento": "Norte de Santander"},
        {"nombre": "Abrego", "departamento": "Norte de Santander"},
        {"nombre": "Arboledas", "departamento": "Norte de Santander"},
        {"nombre": "Bochalema", "departamento": "Norte de Santander"},
        {"nombre": "Bucaramanga", "departamento": "Norte de Santander"},
        {"nombre": "C√°cota", "departamento": "Norte de Santander"},
        {"nombre": "Cachir√°", "departamento": "Norte de Santander"},
        {"nombre": "C√°chira", "departamento": "Norte de Santander"},
        {"nombre": "Cachirilla", "departamento": "Norte de Santander"},
        {"nombre": "Cachita", "departamento": "Norte de Santander"},
        {"nombre": "C√°cota", "departamento": "Norte de Santander"},
        {"nombre": "Cadeita", "departamento": "Norte de Santander"},
        {"nombre": "Cadena", "departamento": "Norte de Santander"},
        {"nombre": "Cadenilla", "departamento": "Norte de Santander"},
        {"nombre": "Cadenita", "departamento": "Norte de Santander"},
        {"nombre": "Cade√±o", "departamento": "Norte de Santander"},
        {"nombre": "Cadete", "departamento": "Norte de Santander"},
        {"nombre": "Cadet√≠a", "departamento": "Norte de Santander"},
        {"nombre": "Cadetilla", "departamento": "Norte de Santander"},
        {"nombre": "Cadetina", "departamento": "Norte de Santander"},
        
        // PUTUMAYO
        {"nombre": "Mocoa", "departamento": "Putumayo"},
        {"nombre": "Col√≥n", "departamento": "Putumayo"},
        {"nombre": "Legu√≠zamo", "departamento": "Putumayo"},
        {"nombre": "Orito", "departamento": "Putumayo"},
        {"nombre": "Puerto As√≠s", "departamento": "Putumayo"},
        {"nombre": "Puerto Caicedo", "departamento": "Putumayo"},
        {"nombre": "Puerto Guzm√°n", "departamento": "Putumayo"},
        {"nombre": "Sibundoy", "departamento": "Putumayo"},
        {"nombre": "Teresita", "departamento": "Putumayo"},
        {"nombre": "Villagarz√≥n", "departamento": "Putumayo"},
        
        // QUIND√çO
        {"nombre": "Armenia", "departamento": "Quind√≠o"},
        {"nombre": "Buenavista", "departamento": "Quind√≠o"},
        {"nombre": "Calarc√°", "departamento": "Quind√≠o"},
        {"nombre": "C√≥rdoba", "departamento": "Quind√≠o"},
        {"nombre": "Filandia", "departamento": "Quind√≠o"},
        {"nombre": "G√©nova", "departamento": "Quind√≠o"},
        {"nombre": "La Ceja", "departamento": "Quind√≠o"},
        {"nombre": "La Tebaida", "departamento": "Quind√≠o"},
        {"nombre": "Montenegro", "departamento": "Quind√≠o"},
        {"nombre": "Pijao", "departamento": "Quind√≠o"},
        {"nombre": "Quimbaya", "departamento": "Quind√≠o"},
        {"nombre": "Salento", "departamento": "Quind√≠o"},
        
        // RISARALDA
        {"nombre": "Pereira", "departamento": "Risaralda"},
        {"nombre": "Apia", "departamento": "Risaralda"},
        {"nombre": "Balboa", "departamento": "Risaralda"},
        {"nombre": "Bel√©n de Umbr√≠a", "departamento": "Risaralda"},
        {"nombre": "Cartago", "departamento": "Risaralda"},
        {"nombre": "Dosquebradas", "departamento": "Risaralda"},
        {"nombre": "Filandia", "departamento": "Risaralda"},
        {"nombre": "Guatica", "departamento": "Risaralda"},
        {"nombre": "La Ceja", "departamento": "Risaralda"},
        {"nombre": "La Virginia", "departamento": "Risaralda"},
        {"nombre": "Marsella", "departamento": "Risaralda"},
        {"nombre": "Mistrat√≥", "departamento": "Risaralda"},
        {"nombre": "Pueblo Rico", "departamento": "Risaralda"},
        {"nombre": "Quinch√≠a", "departamento": "Risaralda"},
        {"nombre": "Santuario", "departamento": "Risaralda"},
        
        // SANTANDER
        {"nombre": "Bucaramanga", "departamento": "Santander"},
        {"nombre": "Aguada", "departamento": "Santander"},
        {"nombre": "Aratoca", "departamento": "Santander"},
        {"nombre": "Arcabuco", "departamento": "Santander"},
        {"nombre": "Arenal", "departamento": "Santander"},
        {"nombre": "Arenisca", "departamento": "Santander"},
        {"nombre": "Arenoso", "departamento": "Santander"},
        {"nombre": "Arenuta", "departamento": "Santander"},
        {"nombre": "Arjona", "departamento": "Santander"},
        {"nombre": "Armero", "departamento": "Santander"},
        {"nombre": "Arminia", "departamento": "Santander"},
        {"nombre": "Armino", "departamento": "Santander"},
        {"nombre": "Arminuelo", "departamento": "Santander"},
        {"nombre": "Armillera", "departamento": "Santander"},
        {"nombre": "Armilla", "departamento": "Santander"},
        {"nombre": "Armillazo", "departamento": "Santander"},
        {"nombre": "Armilleja", "departamento": "Santander"},
        {"nombre": "Armille", "departamento": "Santander"},
        {"nombre": "Armiller√≠a", "departamento": "Santander"},
        {"nombre": "Armilleta", "departamento": "Santander"},
        
        // SUCRE
        {"nombre": "Sincelejo", "departamento": "Sucre"},
        {"nombre": "Buenavista", "departamento": "Sucre"},
        {"nombre": "Caimito", "departamento": "Sucre"},
        {"nombre": "Calamar", "departamento": "Sucre"},
        {"nombre": "Sampu√©s", "departamento": "Sucre"},
        {"nombre": "Colos√≥", "departamento": "Sucre"},
        {"nombre": "Corozal", "departamento": "Sucre"},
        {"nombre": "El Roble", "departamento": "Sucre"},
        {"nombre": "Galeras", "departamento": "Sucre"},
        {"nombre": "La Uni√≥n", "departamento": "Sucre"},
        {"nombre": "Los Palmitos", "departamento": "Sucre"},
        {"nombre": "Morroa", "departamento": "Sucre"},
        {"nombre": "Ovejas", "departamento": "Sucre"},
        {"nombre": "Palmito", "departamento": "Sucre"},
        {"nombre": "Platanillo", "departamento": "Sucre"},
        {"nombre": "San Benito Abad", "departamento": "Sucre"},
        {"nombre": "San Juan de Betulia", "departamento": "Sucre"},
        {"nombre": "San Marcos", "departamento": "Sucre"},
        {"nombre": "San Onofre", "departamento": "Sucre"},
        {"nombre": "San Pedro", "departamento": "Sucre"},
        {"nombre": "San Pelayo", "departamento": "Sucre"},
        {"nombre": "Sucre", "departamento": "Sucre"},
        
        // TOLIMA
        {"nombre": "Ibagu√©", "departamento": "Tolima"},
        {"nombre": "Alvarado", "departamento": "Tolima"},
        {"nombre": "Alpujarra", "departamento": "Tolima"},
        {"nombre": "Ambuema", "departamento": "Tolima"},
        {"nombre": "Amoy√°", "departamento": "Tolima"},
        {"nombre": "Anzo√°tegui", "departamento": "Tolima"},
        {"nombre": "Aracua", "departamento": "Tolima"},
        {"nombre": "Aracuara", "departamento": "Tolima"},
        {"nombre": "Aracuari", "departamento": "Tolima"},
        {"nombre": "Aracuarita", "departamento": "Tolima"},
        {"nombre": "Armenia", "departamento": "Tolima"},
        {"nombre": "Armero", "departamento": "Tolima"},
        {"nombre": "Armero-Guayabal", "departamento": "Tolima"},
        {"nombre": "Arrancaplumas", "departamento": "Tolima"},
        {"nombre": "Arrancaplumaza", "departamento": "Tolima"},
        {"nombre": "Arrancasiete", "departamento": "Tolima"},
        {"nombre": "Arrendajo", "departamento": "Tolima"},
        {"nombre": "Arrendajada", "departamento": "Tolima"},
        {"nombre": "Arrendajador", "departamento": "Tolima"},
        {"nombre": "Arrendajo", "departamento": "Tolima"},
        
        // VALLE DEL CAUCA
        {"nombre": "Cali", "departamento": "Valle del Cauca"},
        {"nombre": "Palmira", "departamento": "Valle del Cauca"},
        {"nombre": "Buenaventura", "departamento": "Valle del Cauca"},
        {"nombre": "Buga", "departamento": "Valle del Cauca"},
        {"nombre": "Cartago", "departamento": "Valle del Cauca"},
        {"nombre": "Jamund√≠", "departamento": "Valle del Cauca"},
        {"nombre": "La Cumbre", "departamento": "Valle del Cauca"},
        {"nombre": "Obando", "departamento": "Valle del Cauca"},
        {"nombre": "Pradera", "departamento": "Valle del Cauca"},
        {"nombre": "Restrepo", "departamento": "Valle del Cauca"},
        {"nombre": "Riofr√≠o", "departamento": "Valle del Cauca"},
        {"nombre": "Tulu√°", "departamento": "Valle del Cauca"},
        {"nombre": "Versalles", "departamento": "Valle del Cauca"},
        {"nombre": "Vijes", "departamento": "Valle del Cauca"},
        {"nombre": "Yotoco", "departamento": "Valle del Cauca"},
        {"nombre": "Zarzal", "departamento": "Valle del Cauca"},
        {"nombre": "Ansermanuevo", "departamento": "Valle del Cauca"},
        {"nombre": "Bol√≠var", "departamento": "Valle del Cauca"},
        {"nombre": "Calim√°-Dari√©n", "departamento": "Valle del Cauca"},
        {"nombre": "Candelaria", "departamento": "Valle del Cauca"},
        {"nombre": "Caparrapis", "departamento": "Valle del Cauca"},
        {"nombre": "Caparrap√≠", "departamento": "Valle del Cauca"},
        {"nombre": "Caparrapi√±o", "departamento": "Valle del Cauca"},
        {"nombre": "Caparr√°pida", "departamento": "Valle del Cauca"},
        {"nombre": "Caparr√°pido", "departamento": "Valle del Cauca"},
        {"nombre": "Caparr√°pil", "departamento": "Valle del Cauca"},
        {"nombre": "Caparr√°pira", "departamento": "Valle del Cauca"},
        {"nombre": "Caparrap√≥", "departamento": "Valle del Cauca"},
        {"nombre": "Caparraquilla", "departamento": "Valle del Cauca"},
        
        // VAUP√âS
        {"nombre": "Mit√∫", "departamento": "Vaup√©s"},
        {"nombre": "Carur√∫", "departamento": "Vaup√©s"},
        {"nombre": "Papunaua", "departamento": "Vaup√©s"},
        {"nombre": "Taraira", "departamento": "Vaup√©s"},
        {"nombre": "Vaup√©s", "departamento": "Vaup√©s"},
        
        // VICHADA
        {"nombre": "Puerto Carre√±o", "departamento": "Vichada"},
        {"nombre": "Cumaribo", "departamento": "Vichada"},
        {"nombre": "La Primavera", "departamento": "Vichada"},
        {"nombre": "Maipures", "departamento": "Vichada"},
        {"nombre": "Puerto Carre√±o", "departamento": "Vichada"},
        {"nombre": "Santa Rosal√≠a", "departamento": "Vichada"}
    ]
};
const procedenciaInput = document.getElementById('procedencia');
const procedenciaLista = document.getElementById('procedencia_lista');

procedenciaInput.addEventListener('input', function() {
    const valor = this.value.toLowerCase().trim();
    
    if (valor.length === 0) {
        procedenciaLista.style.display = 'none';
        return;
    }
    
    const filtrados = municipiosData.municipios.filter(m => 
        m.nombre.toLowerCase().startsWith(valor)
    );
    
    if (filtrados.length > 0) {
        procedenciaLista.innerHTML = filtrados.map(m => 
            `<a class="dropdown-item" href="#" data-value="${m.nombre} (${m.departamento})" 
                style="padding: 8px 12px; display: block; color: #333; text-decoration: none; border-bottom: 1px solid #f0f0f0;">
                <strong>${m.nombre}</strong> <small style="color: #999;">(${m.departamento})</small>
            </a>`
        ).join('');
        
        procedenciaLista.style.display = 'block';
        
        procedenciaLista.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                procedenciaInput.value = this.dataset.value;
                procedenciaLista.style.display = 'none';
            });
        });
    }
});

document.addEventListener('click', function(e) {
    if (e.target !== procedenciaInput) {
        procedenciaLista.style.display = 'none';
    }
});
</script>
<!-- SCRIPT PARA MOSTRAR/OCULTAR DESCRIPCI√ìN DE ALERGIAS -->
<script>
function mostrarDescripcionAlergias() {
    const tieneAlergias = document.querySelector('input[name="tiene_alergias"]:checked').value;
    const container = document.getElementById('descripcion_alergias_container');
    
    if (tieneAlergias === 'si') {
        container.style.display = 'block';
        document.getElementById('descripcion_alergias').required = true;
    } else {
        container.style.display = 'none';
        document.getElementById('descripcion_alergias').required = false;
        document.getElementById('descripcion_alergias').value = '';
    }
}

// Ejecutar al cargar la p√°gina
document.addEventListener('DOMContentLoaded', function() {
    mostrarDescripcionAlergias();
});
</script>
</body>
</html>
